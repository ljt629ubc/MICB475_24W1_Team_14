dada2 including Q value filtering
qiime dada2 denoise-paired \
  --i-demultiplexed-seqs radlab_demux_seqs.qza \
  --p-trunc-len-r 131 \
  --p-trunc-len-f 150 \
  --p-trunc-q 30 \
  --o-representative-sequences rad_lab_q_rep-seqs.qza \
  --o-table rad_lab_q_table.qza \
  --o-denoising-stats rad_lab_1_dada2-stats.qza \
  --verbose \
  &

  qiime metadata tabulate \
  --m-input-file rad_lab_q_dada2-stats.qza \
  --o-visualization rad_lab_q_dada2-stats.qzv

qiime feature-table tabulate-seqs \
  --i-data rad_lab_q_rep-seqs.qza \
  --o-visualization rad_lab_q_rep-seqs.qzv

qiime feature-table summarize \
  --i-table rad_lab_q_table.qza  \
  --o-visualization rad_lab_q_table.qzv \
  --m-sample-metadata-file radiation_lab_metadata.txt


#denoise using trunc len
qiime dada2 denoise-paired \
  --i-demultiplexed-seqs radlab_demux_seqs.qza \
  --p-trunc-len-r 131 \
  --p-trunc-len-f 150 \
  --o-representative-sequences rad_lab_trunc_rep-seqs.qza \
  --o-table rad_lab_trunc_table.qza \
  --o-denoising-stats rad_lab_trunc_dada2-stats.qza \
  --verbose \
  &

  qiime metadata tabulate \
  --m-input-file rad_lab_trunc_dada2-stats.qza \
  --o-visualization rad_lab_trunc_dada2-stats.qzv

qiime feature-table tabulate-seqs \
  --i-data rad_lab_trunc_rep-seqs.qza \
  --o-visualization rad_lab_trunc_rep-seqs.qzv

qiime feature-table summarize \
  --i-table rad_lab_trunc_table.qza  \
  --o-visualization rad_lab_trunc_table.qzv \
  --m-sample-metadata-file radiation_lab_metadata.txt


#Generating taxonomy.qza file for taxonomic analysis using classifier trained for environmental data, as they use the same primers
qiime feature-classifier classify-sklearn \
  --i-classifier /data/space_environment_data/classifier.qza \
  --i-reads trunc_filtered/rad_lab_trunc_rep-seqs.qza \
  --o-classification radlab_taxonomy.qza \
  &

#create phylogenetic tree
qiime phylogeny align-to-tree-mafft-fasttree \
  --i-sequences trunc_filtered/rad_lab_trunc_rep-seqs.qza \
  --o-alignment aligned-radlab_rep-seqs.qza \
  --o-masked-alignment masked-aligned_radlab_rep-seqs.qza \
  --o-tree unrooted-tree_radlab.qza \
  --o-rooted-tree rooted-tree_radlab.qza \
  &

  #Generate taxa bar plots file - start here

qiime taxa barplot \
  --i-table trunc_filtered/rad_lab_trunc_table.qza \
  --i-taxonomy radlab_taxonomy.qza \
  --m-metadata-file radiation_lab_metadata.txt  \
  --o-visualization radlab_taxa_plots.qzv


#filter out chloroplast and mitochondria on table
  qiime taxa filter-table \
  --i-table trunc_filtered/rad_lab_trunc_table.qza \
  --i-taxonomy radlab_taxonomy.qza \
  --p-exclude mitochondria,chloroplast \
  --o-filtered-table radlab_table-no-mito-chloro.qza \
  &
  
qiime feature-table summarize \
  --i-table radlab_table-no-mito-chloro.qza \
  --o-visualization radlab_table-no-mito-chloro.qzv \
  --m-sample-metadata-file radiation_lab_metadata.txt 

# Alpha-rarefaction
qiime diversity alpha-rarefaction \
  --i-table radlab_table-no-mito-chloro.qza \
  --i-phylogeny rooted-tree_radlab.qza \
  --p-max-depth 168802 \
  --m-metadata-file  radiation_lab_metadata.txt\
  --o-visualization alpha-rarefaction_radlab_no_mito_chloro.qzv

