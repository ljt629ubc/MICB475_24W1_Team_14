#Maka a new directory on the shared team server
mkdir space_radiation_data

#Use manifest.tsv file to import and demultiplex the radiation data
qiime tools import \
  --type "SampleData[PairedEndSequencesWithQuality]" \
  --input-format PairedEndFastqManifestPhred33V2 \
  --input-path /mnt/datasets/project_2/nasa/radiation_space_manifest.tsv \
  --output-path ./radiation_demux_seqs_mg.qza

#Viusualize the demultiplexed file 
qiime demux summarize \
  --i-data radiation_demux_seqs_mg.qza \
  --o-visualization radiation_demux_seqs_mg.qzv

#Export radiation_demux_seqs_mg.qzv to loacl device for visualization
#Determine truncation length by visualizing radiation_demux_seqs_mg.qzv on QIIME2 View:
#Truncation selected: No truncation, keep all 153 bases 

# Denoising/Clustering with Dada2 
qiime dada2 denoise-paired \
  --i-demultiplexed-seqs radiation_demux_seqs_mg.qza \
  --p-trim-left-f 0 \
  --p-trim-left-r 0 \
  --p-trunc-len-f 153 \
  --p-trunc-len-r 153 \
  --o-representative-sequences radiation_rep-seqs_mg.qza \
  --o-table radiation_table_mg.qza \
  --o-denoising-stats radiation_stats_mg.qza

#Visualize radiation_rep-seqs_mg.qza file
qiime feature-table tabulate-seqs \
  --i-data radiation_rep-seqs_mg.qza \
  --o-visualization radiation_rep-seqs_mg.qzv

#The radiation_metadata_space.txt file has multiple columns with the same name, to fix this run the code below in R after transferring the metadata 
#file onto local device:
meta <- read.delim(file = "radiation_metadata_space.txt", sep = "\t") #R automatically changes any columns with the same name 
colnames(meta)[colnames(meta) == 'sample.id'] <- 'sample-id' #R automatically changes the name of the first column to "sample.id", however the qiime 
# code is not compatible with this column name so it must be changed back 
write.table(meta, file="space_environment_metadata1.txt", sep="\t", quote=FALSE, row.names = FALSE)

#Transfer the updated metadata file onto the server under space_radiation_data directory
#Visualize radiation_table_mg.qza file using updated metadata file
qiime feature-table summarize \
  --i-table radiation_table_mg.qza \
  --o-visualization radiation_table_mg.qzv \
  --m-sample-metadata-file space_environment_metadata.txt


